# Render Blueprint Configuration
# This file defines all services needed for the Gym Tracking Application
# Documentation: https://render.com/docs/blueprint-spec

services:
  # ============================================
  # Backend API Service (Node.js/Express)
  # ============================================
  - type: web
    name: gym-tracker-api
    runtime: node
    region: oregon  # Options: oregon, frankfurt, singapore, ohio
    plan: free      # Options: free, starter, standard, pro
    branch: main  # Change to 'main' if that's your default branch
    rootDir: backend

    # Build configuration
    buildCommand: |
      npm ci &&
      npx prisma generate &&
      npx prisma migrate deploy

    startCommand: npm start

    # Health check endpoint
    healthCheckPath: /health

    # Environment variables
    envVars:
      - key: NODE_ENV
        value: production

      - key: DATABASE_URL
        fromDatabase:
          name: gym-tracker-db
          property: connectionString

      - key: PORT
        value: 5001

      # Set this manually after frontend is deployed
      - key: FRONTEND_URL
        sync: false

    # Auto-deploy on git push
    autoDeploy: true

  # ============================================
  # Frontend Static Site (React/Vite)
  # ============================================
  - type: web
    name: gym-tracker-frontend
    runtime: static
    branch: main  # Change to 'main' if that's your default branch
    rootDir: frontend

    # Build configuration
    buildCommand: npm ci && npm run build
    staticPublishPath: dist

    # Routes configuration for SPA
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

    # Environment variables
    envVars:
      # Set this manually after backend is deployed
      - key: VITE_API_URL
        sync: false
      - key: VITE_ADMIN_PASSWORD
        sync: false

    # Auto-deploy on git push
    autoDeploy: true

# ============================================
# PostgreSQL Database
# ============================================
databases:
  - name: gym-tracker-db
    plan: free          # Options: free, starter, standard, pro
    databaseName: gym_tracker_production
    user: gym_tracker_user
    region: oregon      # Should match services region
    postgresMajorVersion: 15

    # Database will be automatically deleted after 90 days of inactivity (free tier only)
    # Upgrade to starter ($7/mo) for permanent storage and automated backups
